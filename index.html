<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>New Document</title>
    <!--<link rel="stylesheet" href="styles.css">-->
    <script src="https://cdn.plot.ly/plotly-3.0.1.min.js" charset="utf-8"></script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
      window.MathJax = {
         tex: {
           tags: 'ams'
         }
      };

      function plot(x, y, ...rest) {
        const div = document.createElement("div");
        document.body.append(div);
        const data = [{
          x,
          y,
          //type: 'scatter'
        }];
        for (let i = 0; i < rest.length; i += 2) {
          data.push({
            x: rest[i],
            y: rest[i + 1],
          });
        }
        Plotly.newPlot(div, data);
      }

      function gcd(a, b) {
        if (b === 0) {
          return a;
        } else {
          return gcd(b, a % b);
        }
      }

      function qadd([a, b], [c, d]) {
        const r = [a*d + b*c, b*d];
        const e = gcd(r[0], r[1]);
        return [r[0] / e, r[1] / e];
      }

      function qsub([a, b], [c, d]) {
        const r = [a*d - b*c, b*d];
        const e = gcd(...r);
        return [r[0] / e, r[1] / e];
      }

      function qmult([a, b], [c, d]) {
        const r = [a*c, b*d];
        const e = gcd(...r);
        return [r[0] / e, r[1] / e];
      }

      function qdiv([a, b], [c, d]) {
        const r = [a*d, b*c];
        const e = gcd(...r);
        return [r[0] / e, r[1] / e];
      }

      function qprint([a, b]) {
        document.body.append(`\\(\\frac {${a}} {${b}}\\)`);
      }

      function range(n) {
        return [...new Array(n).keys()];
      }
    </script>
  </head>
  <body>
    <h1>Étude de la fonction Collatz</h1>
    <p>
    On définit la fonction Collatz
    $$C(x) = C_{[x]}(x)$$
    où
    $$
      \begin{align*}
      C_{[0]}(x) & = \frac x 2 \\
      C_{[1]}(x) & = \frac 3 2 x + \frac 1 2.
      \end{align*}
    $$
    </p>
    <p>
    Soit \(x \in \mathbb N\), alors on s'intéresse à 2 séquences
    $$x_i = C^i(x)$$
    et
    $$C_i = C_{[x_i]}.$$
    </p>

    <p>
    Une formule générale pour \(C^n(x)\),
    $$
    \begin{equation}
      C^n(x) = \frac {3^\omega} {2^{\omega+\alpha_\omega}} x +
      \frac 1 2 \sum_{i=0}^{\omega-1} \frac {3^i} {2^{i+\alpha_i}},
      \label{Collatzn}
    \end{equation}
    $$
    où \(\omega\) est le nombre de \(C_i = C_{[1]}\) et \(\alpha_j\) est le nombre de \(C_i = C_{[0]}\) suivant le (\(\omega - j\))-ième \(C_{[1]}\), pour \(i\) allant de 0 à \(n - 1\) et \(j\) allant de 0 à \(\omega\). Pour le terme \(\alpha_\omega\), on le définit comme le nombre total de \(C_i = C_{[0]}\), pour \(i \lt n\).
    </p>

    <p>
    Exemple, on prend \(x_0 = 6\) et \(n = 6\). Alors la séquence des \(x_i\) est ( 6, 3, 5, 8, 4, 2, 1) et la séquence des \(C_i\) est (\(C_{[0]}\), \(C_{[1]}\), \(C_{[1]}\), \(C_{[0]}\), \(C_{[0]}\), \(C_{[0]}\), \(C_{[1]}\)). On a \(\omega = 2\) et la séquence \(\alpha_i\) est (3, 3, 4). On obtient
    $$
    \begin{align*}
    C^6(6) & = \frac {3^2} {2^{2+4}} 6 +
      \frac 1 2 \left( 
      \frac {3^0} {2^{0+3}} + 
      \frac {3^1} {2^{1+3}}
      \right) \\
      & = 1.
    \end{align*}
    $$
    </p>

    <p>
    On peut vouloir s'affranchir des termes \(x_i\) et simplement s'intéresser à l'ensemble des fonctions générées par \(g = C_{[0]}\) et \(h = C_{[1]}\) par composition, élargies au domaine \(\mathbb Q\). Nous dénoterons l'ensemble de ces fonctions par \(\left< g,  h \right> \).
    </p>

    <p>
    La principale question qui nous intéresse au sujet de la fonction Collatz est de savoir s'il existe d'autres cycles que (1, 2) dans les entiers positifs. Autrement dit, existe-t-il une fonction \(f \in \left< g, h \right>\) dont le point fixe est un entier positif différent de 1 et 2.
    </p>

    <p>
    
    Calculons les points fixes de quelques fonctions de cet ensemble:
    </p>

    <table>
      <thead>
      <tr>
        <th>Fonction</th>
        <th>Point fixe</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td>\(g\)</td>
        <td>0</td>
      </tr>
      <tr>
        <td>\(h\)</td>
        <td>-1</td>
      </tr>
      <tr>
        <td>\(g \circ h\)</td>
        <td>2</td>
      </tr>
      <tr>
        <td>\(h \circ g\)</td>
        <td>1</td>
      </tr>
      <tr>
        <td>\(g \circ g\)</td>
        <td>0</td>
      </tr>
      <tr>
        <td>\(g \circ g \circ h\)</td>
        <td>\(\frac 1 5\)</td>
      </tr>
      <tr>
        <td>\(g \circ h \circ g\)</td>
        <td>\(\frac 2 5\)</td>
      </tr>
      <tr>
        <td>\(g \circ h \circ h\)</td>
        <td>-5</td>
      </tr>
      <tr>
        <td>\(h \circ g \circ g\)</td>
        <td>\(\frac 4 5\)</td>
      </tr>
      <tr>
        <td>\(h \circ g \circ h\)</td>
        <td>-7</td>
      </tr>
      <tr>
        <td>\(h \circ h \circ g\)</td>
        <td>-10</td>
      </tr>
      </tbody>
    </table>

    <p>
    Il est intéressant d'observer qu'il existe d'autres points fixes dans les entiers négatifs qui correspondent aux cycles (-1), (-5, -7, -10). Ces deux cycles sont en fait associés à une fonction soeur similaire à la fonction Collatz, mais où \(C_{[1]}(x) = \frac 3 2 x - \frac 1 2\). Nous y reviendrons plus tard.
    </p>

    <p>
    Puisque nous nous intéressont seulement aux cycles d'entiers positifs, nous devons trouver une condition pour que le point fixe soit plus grand que zéro. Prenons l'équation en \(\eqref{Collatzn}\) et remplaçons la partie qui ne dépend pas de \(x\) par une constante:
    $$
\begin{equation}
      C^n(x) = \frac {3^\omega} {2^{\omega+\alpha_\omega}} x + K.
      \label{Collatzn2}
    \end{equation}
    $$
    </p>

    <p>
    Posons \(C^n(x) = x\) et résolvons l'équation. Nous obtenons:

    $$
    \begin{align}
      \frac {3^\omega} {2^{\omega+\alpha_\omega}} x + K & = x \\
      x& = \frac K {2^{\omega+\alpha_\omega} - {3^\omega}}
    \end{align}

    $$
    </p>

    <p>
    $$
    2^{n \ln 3 / \ln 2} - 3^n \gt 0
    $$
    </p>

    <p>
    $$
    \begin{align*}
    \sum_{i=0}^n {\left( \frac 3 2 \right)^i} & = 
    \frac {1 - \left( \frac 3 2 \right)^{n+1}} {1 - \frac 3 2} \\
    & = \frac {3^{n+1} - 2^{n+1}} {2^n}
    \end{align*}
    $$
    </p>

    <script>
      function* nat() {
        yield 0;
        for (const n of nat()) {
          yield 1 + n;
        }
      }
      (() => {
        const g = nat();
        const div = document.createElement("pre");
        documeny.body.append(pre);
        pre.innerHTML += g.next() + "\n";
        
      })()
    </script>

    <script>
      const LN_3_2 = Math.log(3) / Math.log(2);
      const xs = range(5);
      const ys = xs.map(x => 2**Math.ceil(x*LN_3_2) - 3**x);
      const us = xs.map(x => 3**x - 2**x);
      plot(xs, ys, xs, us);
    </script>
  </body>
</html>
